const danmakuColors=[["#0008","white"]],maxdanmakuWidth=150,maxdanmakuHeight=100,danmakuTime=2e3,twikooUrl="https://tkapin.yaria.top/.netlify/functions/twikoo",accessToken="1059857c25a2ce9fba9cff298f4f33ee",pageUrl="/messageboard/",maxdanmaku=50,danmakuTimer=[];let danmakuList=[],danmakuIndex=0;function getStyle(a,t){return window.getComputedStyle?getComputedStyle(a,null)[t]:a.currentStyle[t]}function toggleDanmaku(){$("#danmaku-container").toggle()}function linkFilter(a){return a.filter((a=>!a.master))}function popdanmaku(a){let t=document.createElement("div"),e=danmakuDom.clientWidth,n=danmakuDom.clientHeight;t.className="danmaku",t.style.top=Math.floor(Math.random()*(n-100))+"px",t.style.left=e+"px";let d=Math.floor(Math.random()*danmakuColors.length);t.style.background=danmakuColors[d][0],t.style.color=danmakuColors[d][1],t.innerHTML=`\n\t\t<div class="danmakuHead">\n\t\t\t<div class="danmakuNick">${a.nick}</div>\n\t\t\t<img class="danmakuAvatar" src="https://weavatar.com/avatar/${a.mailMd5}"/>\n\t\t</div>\n\t\t<div class="danmakuContent">${a.comment}</div>\n\t`,danmakuTimer.push(t),danmakuDom.append(t),setTimeout((()=>{t.style.left=-(3*t.clientWidth+500).toString()+"px",setTimeout((()=>{t.style.left=-(3*t.clientWidth+500).toString()+"px"}),15e3)}),50)}showDanmaku=()=>{danmakuDom=document.getElementById("danmaku-container");var a=JSON.stringify({event:"COMMENT_GET",accessToken:accessToken,url:pageUrl}),t=new XMLHttpRequest;t.withCredentials=!0,t.addEventListener("readystatechange",(function(){4===this.readyState&&(danmakuList=linkFilter(JSON.parse(this.responseText).data),danmakuDom.innerHTML="")})),t.open("POST",twikooUrl),t.setRequestHeader("Content-Type","application/json"),t.send(a),setInterval((()=>{danmakuList.length&&(popdanmaku(danmakuList[danmakuIndex]),danmakuIndex+=1,danmakuIndex%=danmakuList.length),danmakuTimer.length>(danmakuList.length>50?50:danmakuList.length)&&removedanmaku(danmakuTimer.shift())}),2e3)},window.addEventListener("load",showDanmaku),window.addEventListener("pjax:complete",showDanmaku),removedanmaku=a=>{danmakuDom.removeChild(a)};