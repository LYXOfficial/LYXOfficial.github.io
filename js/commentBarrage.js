function startbarrage(){try{clearInterval(timer),document.querySelector(".comment-barrage").innerHTML="",delete sw}catch(e){}if(null==document.querySelector("#twikoo"))return;const e={lightColors:[["var(--lyx-white-acrylic2)","var(--lyx-black)"]],darkColors:[["var(--lyx-black-acrylic2)","var(--lyx-white)"]],barrageTime:3e3,twikooUrl:"https://tkapin.yaria.top/.netlify/functions/twikoo",accessToken:"1059857c25a2ce9fba9cff298f4f33ee",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,noAvatarType:"mp",dom:document.querySelector(".comment-barrage"),displayBarrage:!0,avatarCDN:"weavatar.com"};function a(e){var a=e;return 1==new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/).test(a)}function t(e){const a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e.offsetTop-document.documentElement.scrollTop<=a}function r(e){if(e.replies){let a=[e];return e.replies.forEach((e=>{a.push(...r(e))})),a}return[]}function n(t){let r=document.createElement("div");e.dom.clientWidth,e.dom.clientHeight;r.className="comment-barrage-item";let n=Math.floor(Math.random()*e.lightColors.length);document.getElementById("barragesColor").innerHTML=`[data-theme='light'] .comment-barrage-item { background-color:${e.lightColors[n][0]};color:${e.lightColors[n][1]}}[data-theme='dark'] .comment-barrage-item{ background-color:${e.darkColors[n][0]};color:${e.darkColors[n][1]}}`,null!=t.avatar?null!=t.link?(a(t.link)||(t.link="http://"+t.link),r.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="${t.avatar}"/>\n                <a href="${t.link}" class="barrageNick" target="_blank">${t.nick}</a>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            `):r.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="${t.avatar}"/>\n                <div class="barrageNick">${t.nick}</div>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            `:null!=t.link?(a(t.link)||(t.link="http://"+t.link),r.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="https://${e.avatarCDN}/avatar/${t.mailMd5}?d=${e.noAvatarType}"/>\n                <a href="${t.link}" class="barrageNick" target="_blank">${t.nick}</a>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            `):r.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="https://${e.avatarCDN}/avatar/${t.mailMd5}?d=${e.noAvatarType}"/>\n                <div class="barrageNick">${t.nick}</div>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            `,barrageContent=document.createElement("a"),barrageContent.className="barrageContent",barrageContent.href="#"+t.id,barrageContent.innerHTML=t.comment,r.appendChild(barrageContent),aswiper=document.createElement("div"),aswiper.className="swiper-slide",aswiper.setAttribute("style","height: 150px;"),aswiper.append(r),e.dom.append(aswiper)}var o,s;-1==location.href.indexOf("posts")&&-1==location.href.indexOf("posts")||(document.onscroll=function(){t(document.getElementById("post-comment"))?(document.getElementsByClassName("barrageswiper")[0].style.transform="translateX(514px)",document.getElementsByClassName("barrageswiper")[0].style.opacity="0"):(document.getElementsByClassName("barrageswiper")[0].style.transform="",document.getElementsByClassName("barrageswiper")[0].style.opacity="1")}),switchCommentBarrage=function(){if(localStorage.setItem("isBarrageToggle",Number(!Number(localStorage.getItem("isBarrageToggle")))),!t(document.getElementById("post-comment"))){e.displayBarrage=!e.displayBarrage;let a=document.querySelector(".comment-barrage");a&&$(a).fadeToggle()}},null==localStorage.getItem("isBarrageToggle")?localStorage.setItem("isBarrageToggle","0"):"1"==localStorage.getItem("isBarrageToggle")&&(localStorage.setItem("isBarrageToggle","0"),switchCommentBarrage()),o=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":e.accessToken,url:e.pageUrl}),(s=new XMLHttpRequest).withCredentials=!0,s.addEventListener("readystatechange",(function(){if(4===this.readyState){for(e.barrageList=function(e){e.sort(((e,a)=>e.created-a.created));let a=[];return e.forEach((e=>{a.push(...r(e))})),a}(JSON.parse(this.responseText).data),e.dom.innerHTML="",e.barrageIndex=0;e.barrageIndex<e.barrageList.length;e.barrageIndex++)n(e.barrageList[e.barrageIndex]);kkksc03=new Swiper(".barrageswiper",{direction:"vertical",loop:!0,mousewheel:!0,autoplay:{delay:e.barrageTime,stopOnLastSlide:!1,disableOnInteraction:!1}}),kkksc03.el.onmouseover=function(){kkksc03.autoplay.stop()},kkksc03.el.onmouseout=function(){kkksc03.autoplay.start()}}})),s.open("POST",e.twikooUrl),s.setRequestHeader("Content-Type","application/json"),s.send(o)}document.addEventListener("pjax:complete",startbarrage),document.addEventListener("DOMContentLoaded",startbarrage);